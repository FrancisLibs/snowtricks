{% extends 'base.html.twig' %}

{% block title %}Profil utilisateur{% endblock %}

{% block insert %}
   <div class="row align-items-center" id="content-panel">
		<div class="offset-1 col-10 offset-sm-3 col-sm-6 offset-md-3 col-md-4 offset-lg-4 col-lg-3 offset-xl-4 col-xl-3 text-center reset-password-form">
			<h4>Mon compte</h4>
            <div class="d-flex flex-row justify-content-between">
            <div class="d-flex flex-column justify-content-start align-items-start">
                <h4>Nom : {{ user.username}}</h4>
                <h5>Email : {{ user.email }}</h5>
            </div>
            <div>
                {% if user.userPicture %}
                    <img class="profil-picture" src="{{ '/media/userPicture/' ~ user.userPicture }}" alt="{{ user.username }}">
                {% else %}
                    <img class="profil-picture" src="/media/userPicture/emptyprofil.jpg" alt="">
                {% endif %}
            </div>
        </div>
        <div>
            <a href="{{ path('user.password.reset') }}">Reset mot de passe</a><br />
            <a id="delete-user-picture" href="{{ path('delete.picture') }}">Effacer image</a><br />
            <a id="replace-user-picture" href="{{ path('change.picture') }}">Remplacer image</a>
        </div>
		</div>
	</div>
{% endblock %}

{% javascript block %}
    <script>
        // Remplacement photo de l'utilisateur
        champInput = "variable globale";
        btnDeletePicture = "variable globale";
        btnEditPicture = $('.btn_edit_picture');
        $(function () {
            $("#delegation").on('click', ('.btn_edit_picture'), function (e) {
                e.preventDefault();
                btnEditPicture = $(this).hide('slow');
                btnDeletePicture = btnEditPicture.next();
                btnDeletePicture = $(this).next().hide('slow');
                champInput = $(this).next().next();
                champInput.find('input').val("");
                champInput.show('slow');
            })
        })

        $(function () {
            var selector = document.getElementsByName('uploadPictureFile');
            $("#delegation").on('change', ("[name='uploadPictureFile']"), function () { 
                var path = $(this).next();
                var ancienneImage = $(this).parent().parent().parent();
                var file = $(this)[0].files[0];
                var formData = new FormData();
                formData.append("file", file);

                $.ajax({
                    type: "POST",
                    url: path.attr('data-path'),
                    data: formData,
                    cache: false,
                    contentType: false,
                    processData: false,
                    async: false,
                    dataType: "html",
                    error: function (err) {
                        console.error(err);
                    },
                    success: function (data) {
                        ancienneImage.html(data);
                    },
                    complete: function () {
                        console.log("Request finished.");
                    }
                });
            });
        });
    </script>

{% endblock %}